// finder-clone - version 1.0.012 - https://github.com/Pamblam/finder-clone
class FSEntry{constructor(t,e,i,a){this.name=t,this.size=e,this.kind=i,this.date=a,this.children=null,this.parent=null,this.expanded=!1}getIcon(){switch(this.kind.toLowerCase()){case"spreadsheet":return'<i class="fa-solid fa-file-excel"></i>';case"document":return'<i class="fa-solid fa-file-word"></i>';case"pdf":return'<i class="fa-solid fa-file-pdf"></i>';case"archive":return'<i class="fa-solid fa-file-zipper"></i>';case"video":return'<i class="fa-solid fa-file-video"></i>';case"powerpoint":return'<i class="fa-solid fa-file-powerpoint"></i>';case"image":return'<i class="fa-solid fa-file-image"></i>';case"code":return'<i class="fa-solid fa-file-code"></i>';case"audio":return'<i class="fa-solid fa-file-audio"></i>';case"folder":return'<i class="fa-solid fa-folder"></i>';default:return'<i class="fa-solid fa-file"></i>'}}getName(t=0){var e=`<i class="fa-solid fa-angle-right" ${`style="opacity: ${"folder"==this.kind.toLowerCase()?"1":"0"}; transform: rotate(${this.expanded?90:0}deg);"`}></i>`;return`<span class='ft-name-span'>${"&nbsp;&nbsp;&nbsp;&nbsp;".repeat(t)}${e} ${this.getIcon()} ${this.name}</span>`}getSize(){if(!this.size)return"";var t=["kB","MB","GB","TB","PB","EB","ZB","YB"];let e=this.size;if(Math.abs(e)<1e3)return e+" B";let i=-1;for(;e/=1e3,++i,1e3<=Math.round(10*Math.abs(e))/10&&i<t.length-1;);return e.toFixed(1)+" "+t[i]}getKind(){return this.kind}getDate(){return new Date(1e3*this.date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}getPath(t="/"){let e=this.parent;for(var i=[this.name];null!==e;)i.unshift(e.name),e=e.parent;let a=t+i.join(t);return"Folder"===this.kind&&(a+=t),a}}class FSTable{static version="1.0.012";constructor(t,e){this.entry_counter=0,this.table=document.createElement("div"),this.entries=[],this.entries_map={},this.table.classList.add("ft-table"),this.sort_col="Name",this.sort_dir="asc",this.user_callbacks={"folder.expand":[],"folder.collapse":[],"file.click":[]},this.onExpand=e,this.col_widths={},this.col_sizes_json="",t.replaceWith(this.table),this._onResize=t=>{var r=this.calculateColumnSizes();if(!1!==r){let[e,i,a,s]=r;this.table.querySelectorAll(".ft-td-name").forEach(t=>t.style.width=e+"px"),this.table.querySelectorAll(".ft-td-kind").forEach(t=>t.style.width=a+"px"),this.table.querySelectorAll(".ft-td-size").forEach(t=>t.style.width=i+"px"),this.table.querySelectorAll(".ft-td-date").forEach(t=>t.style.width=s+"px")}},addEventListener("resize",this._onResize)}on(t,e){this.user_callbacks[t].push(e)}off(t,e){this.user_callbacks[t]=this.user_callbacks[t].filter(t=>t!==e)}getMinRequiredWidth(t){var e=t.style.width,i=(t.style.width="1px",t.scrollWidth);return t.style.width=e,i}getAllMinWidths(){var t=[...this.table.querySelectorAll(".ft-td-name")].map(this.getMinRequiredWidth),t=Math.max(...t),e=[...this.table.querySelectorAll(".ft-td-size")].map(this.getMinRequiredWidth),e=Math.max(...e),i=[...this.table.querySelectorAll(".ft-td-kind")].map(this.getMinRequiredWidth),i=Math.max(...i),a=[...this.table.querySelectorAll(".ft-td-date")].map(this.getMinRequiredWidth);return[t,e,i,Math.max(...a)]}getActualWidth(t){t=getComputedStyle(t).getPropertyValue("width");return+t.substring(0,t.length-2)}getAllActualWidths(){return[this.getActualWidth(this.table.querySelector(".ft-td-name")),this.getActualWidth(this.table.querySelector(".ft-td-size")),this.getActualWidth(this.table.querySelector(".ft-td-kind")),this.getActualWidth(this.table.querySelector(".ft-td-date"))]}getHorizontalMarginPaddingBorder(e){return["margin-left","margin-right","border-left-width","border-right-width","padding-left","padding-right"].map(t=>{t=getComputedStyle(e).getPropertyValue(t);return+t.substring(0,t.length-2)}).reduce((t,e)=>t+e,0)}getAllColsMPB(){return this.getHorizontalMarginPaddingBorder(this.table.querySelector(".ft-td-name"))+this.getHorizontalMarginPaddingBorder(this.table.querySelector(".ft-td-size"))+this.getHorizontalMarginPaddingBorder(this.table.querySelector(".ft-td-kind"))+this.getHorizontalMarginPaddingBorder(this.table.querySelector(".ft-td-date"))}getAvailableTableWidth(){return this.getActualWidth(this.table.querySelector(".ft-tr"))-this.getAllColsMPB()}calculateColumnSizes(){var t=this.getAllMinWidths(),e=this.getAvailableTableWidth(),[i,a,s,r]=t,t=JSON.stringify([e,...t]);if(this.col_sizes_json===t)return this.resizing=!1;this.col_sizes_json=t;var[t,l,n,d]=this.getAllActualWidths(),o=i+a+s+r;let h,c,u,f;return o<=e?(this.table.style.minWidth=null,e=e-o,e=(e=(e-=(f=Math.floor(Math.min(r+.25*e,r+10)))-r)-((u=Math.floor(Math.min(s+.125*e,s+10)))-s))-((c=Math.floor(Math.min(a+.125*e,a+10)))-a),h=i+e):(this.table.style.minWidth=o+this.getAllColsMPB()+"px",h=i,c=a,u=s,f=r),this.col_widths.name=h,this.col_widths.size=c,this.col_widths.kind=u,this.col_widths.date=f,[h,c,u,f,t,l,n,d]}async resizeTable(){if(!this.resizing){this.resizing=!0;var t=this.calculateColumnSizes();if(!1===t)return this.resizing=!1;let[e,i,a,s,r,l,n,d]=t;var t=[...this.table.querySelectorAll(".ft-td-name")],o=[...this.table.querySelectorAll(".ft-td-kind")],h=[...this.table.querySelectorAll(".ft-td-size")],c=[...this.table.querySelectorAll(".ft-td-date")];await Promise.all([...t.map(t=>this.animate(t,"width",r,e,t=>t+"px",150)),...o.map(t=>this.animate(t,"width",n,a,t=>t+"px",150)),...h.map(t=>this.animate(t,"width",l,i,t=>t+"px",150)),...c.map(t=>this.animate(t,"width",d,s,t=>t+"px",150))]),this.resizing=!1}}getSortedEntries(t){return[...t].sort((t,e)=>{t=t[this.sort_col.toLowerCase()],e=e[this.sort_col.toLowerCase()];return t==e?0:e<t?"asc"===this.sort_dir?1:-1:t<e?"asc"===this.sort_dir?-1:1:void 0})}renderTable(){this.table.textContent="";let a=document.createElement("div");a.classList.add("ft-th"),["Name","Size","Kind","Date"].forEach(t=>{var e=document.createElement("div");e.classList.add("ft-td-"+t.toLowerCase()),this.col_widths[t.toLowerCase()]&&(e.style.width=this.col_widths[t.toLowerCase()]+"px");let i=`<span class='ft-pull-left'>${t}</span>`;this.sort_col===t&&(t="asc"===this.sort_dir?'<i class="fa-solid fa-angle-up"></i>':'<i class="fa-solid fa-angle-down"></i>',i+=`<span class='ft-pull-right'>${t}</span>`),i+="<span class='ft-clear'></span>",e.innerHTML=i,a.appendChild(e)}),this.table.appendChild(a);var t=this.getSortedEntries(this.entries);!function e(r,t,i=null,l=!0,n=0,d=!1){t.forEach(a=>{let s=document.createElement("div");var t;s.dataset.eid=a.id,s.classList.add("ft-tr"),l&&!d||(s.style.display="none",d=!0),i&&(s.dataset.pid=i),["Name","Size","Kind","Date"].forEach(t=>{var e=document.createElement("div");e.classList.add("ft-td-"+t.toLowerCase()),r.col_widths[t.toLowerCase()]&&(e.style.width=r.col_widths[t.toLowerCase()]+"px");let i;i="Name"===t?a.getName(n):a["get"+t](),e.innerHTML=i,s.appendChild(e)}),r.table.appendChild(s),"folder"===a.kind.toLowerCase()&&Array.isArray(a.children)&&(t=r.getSortedEntries(a.children),e(r,t,a.id,a.expanded,n+1,d))})}(this,t),this.addTableStripes(),this.table.querySelectorAll(".ft-th > div").forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();let e;t.currentTarget.classList.contains("ft-td-size")&&(e="Size"),t.currentTarget.classList.contains("ft-td-kind")&&(e="Kind"),t.currentTarget.classList.contains("ft-td-date")&&(e="Date"),(e=t.currentTarget.classList.contains("ft-td-name")?"Name":e)&&(e===this.sort_col?this.sort_dir="asc"===this.sort_dir?"desc":"asc":this.sort_dir="asc",this.sort_col=e,this.renderTable())})}),this.table.querySelectorAll(".ft-name-span").forEach(a=>{a.addEventListener("click",async t=>{t.preventDefault();var e,t=a.parentElement.parentElement.dataset.eid;let i=this.entries_map[t];"Folder"===i.kind?(i.expanded?(e=this.user_callbacks["folder.collapse"].map(t=>Promise.resolve(t(i))),await Promise.all(e),e=document.querySelector(`.ft-tr[data-eid="${t}"]`),e=(a=e.querySelector(".ft-name-span")).parentElement.querySelector(".fa-angle-right"),await this.animate(e,"transform",90,0,t=>`rotate(${t}deg)`,150),this.getAllChildrenIds(i).forEach(t=>{document.querySelector(`.ft-tr[data-eid="${t}"]`).style.display="none"}),i.expanded=!1):(e=this.user_callbacks["folder.expand"].map(t=>Promise.resolve(t(i))),await Promise.all(e),e=document.querySelector(`.ft-tr[data-eid="${t}"]`),t=(a=e.querySelector(".ft-name-span")).parentElement.querySelector(".fa-angle-right"),await this.animate(t,"transform",0,90,t=>`rotate(${t}deg)`,150),function e(t,i){Array.isArray(t.children)&&t.children.forEach(t=>{document.querySelector(`.ft-tr[data-eid="${t.id}"]`).style.display=i?null:"none","Folder"===t.kind&&(t.expanded||(i=!1),e(t,i))})}(i,!0),i.expanded=!0),this.addTableStripes(),this.resizeTable()):(e=this.user_callbacks["file.click"].map(t=>Promise.resolve(t(i))),await Promise.all(e))})}),this.resizeTable()}addTableStripes(){let e=0;this.table.querySelectorAll(".ft-tr").forEach(t=>{t.style.display&&"none"===t.style.display||(e%2==0?t.classList.contains("ft-tr-odd")||t.classList.add("ft-tr-odd"):t.classList.contains("ft-tr-odd")&&t.classList.remove("ft-tr-odd"),e++)})}getAllChildrenIds(t){let i=[];return function e(t){Array.isArray(t.children)&&t.children.forEach(t=>{i.push(t.id),"Folder"===t.kind&&e(t)})}(t),i}addEntries(t,e=null){let i;(i=e?(e.children||(e.children=[]),e.children):this.entries).push(...t.map(t=>(t.id=this.entry_counter,t.parent=e,this.entries_map[t.id]=t,this.entry_counter++,t))),this.renderTable()}animate(n,d,o,h,c,u){return new Promise((s,t)=>{let r=Date.now(),l=Math.abs(o-h);!function a(){requestAnimationFrame(()=>{var t=(Date.now()-r)/u,t=l*t;let e;e=h<o?Math.max(o-t,h):Math.min(o+t,h);let i;i="function"==typeof c?c(e):""+e+c,n.style[d]=i,(e==h?s:a)()})}()})}}export{FSEntry,FSTable};