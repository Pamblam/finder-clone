// finder-clone - version 1.5.116 - https://github.com/Pamblam/finder-clone
class FSEntry{constructor(t,e,i,s,r=null){this.name=t,this.size=e,this.kind=i,this.date=s,this.children=null,this.parent=null,this.expanded=!1,this.selected=!1,this.nameRenderer=r,this.prefix=""}getIcon(){switch(this.kind.toLowerCase()){case"spreadsheet":return'<i class="fa-solid fa-file-excel"></i>';case"document":return'<i class="fa-solid fa-file-word"></i>';case"pdf":return'<i class="fa-solid fa-file-pdf"></i>';case"archive":return'<i class="fa-solid fa-file-zipper"></i>';case"video":return'<i class="fa-solid fa-file-video"></i>';case"powerpoint":return'<i class="fa-solid fa-file-powerpoint"></i>';case"image":return'<i class="fa-solid fa-file-image"></i>';case"code":return'<i class="fa-solid fa-file-code"></i>';case"audio":return'<i class="fa-solid fa-file-audio"></i>';case"folder":return'<i class="fa-solid fa-folder ft-folder-icon"></i>';default:return'<i class="fa-solid fa-file"></i>'}}getName(t=0){var e=`<i class="fa-solid fa-angle-right folder-carat" ${`style="opacity: ${"folder"==this.kind.toLowerCase()?"1":"0"}; transform: rotate(${this.expanded?90:0}deg);"`}></i>`,t="&nbsp;&nbsp;&nbsp;&nbsp;".repeat(t),i="function"==typeof this.nameRenderer?this.nameRenderer(this.name):this.name;return`<span class='ft-name-span'>${t}${e} ${this.getIcon()} ${i}</span>`}getSize(){if(!this.size)return"--";var t=["kB","MB","GB","TB","PB","EB","ZB","YB"];let e=this.size;if(Math.abs(e)<1e3)return e+" B";let i=-1;for(;e/=1e3,++i,1e3<=Math.round(10*Math.abs(e))/10&&i<t.length-1;);return e.toFixed(1)+" "+t[i]}getKind(){return this.kind}getDate(){return new Date(1e3*this.date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour12:!0,hour:"numeric",minute:"2-digit"})}getPath(t="/"){let e=this.parent;for(var i=[this.name];null!==e;)i.unshift(e.name),e=e.parent;let s=t+i.join(t);return"Folder"===this.kind&&(s+=t),(""+t+this.prefix+s).replaceAll(""+t+t,t)}}class FSTable{static version="1.5.116";constructor(t,e,i=!1,s=!1){if(this.entry_counter=0,this.table=document.createElement("div"),this.prefix=e||"",this.entries=[],this.entries_map={},this.table.classList.add("ft-table"),this.sort_col="Name",this.sort_dir="asc",this.ctxmenu=null,this.conextMenuOpts=[],this.user_callbacks={"folder.expand":[],"folder.collapse":[],"row.click":[],"table.sort":[],"row.dblclick":[],"row.ctxmenu":[]},s){if("object"!=typeof s||"FI"!==s?.constructor?.name)throw new Error("FI parameter must be an instance of FI: https://github.com/Pamblam/file-input");if(!this.isVersionGreaterThanOrEqualTo(s.constructor.version,"2.1.51"))throw new Error("FI versions prior to 2.1.51 are not supported.")}this.fi=s,this.light_mode=i,this.light_mode&&this.table.classList.add("light"),this.history=[],this.col_widths={},this.col_sizes_json="",t.replaceWith(this.table),this._onResize=t=>{var a=this.calculateColumnSizes();if(!1!==a){let[e,i,s,r]=a;this.table.querySelectorAll(".ft-td-name").forEach(t=>t.style.width=e+"px"),this.table.querySelectorAll(".ft-td-kind").forEach(t=>t.style.width=s+"px"),this.table.querySelectorAll(".ft-td-size").forEach(t=>t.style.width=i+"px"),this.table.querySelectorAll(".ft-td-date").forEach(t=>t.style.width=r+"px"),this.removeCtxMenu()}},addEventListener("resize",this._onResize),this._onClick=e=>{if(this.ctxmenu){let t=e.target;for(;;){if(t===this.ctxmenu)return;if(!t.parentElement)break;t=t.parentElement}this.removeCtxMenu()}},addEventListener("click",this._onClick),this._onCtxmenu=e=>{if(this.ctxmenu){let t=e.target;for(;;){if(t.classList.contains("ft-contextmenu"))return e.preventDefault(),e.stopPropagation(),!1;if(!t.parentElement)break;t=t.parentElement}for(t=e.target;;){if(t.classList.contains("ft-tr"))return;if(!t.parentElement)break;t=t.parentElement}this.removeCtxMenu()}},addEventListener("contextmenu",this._onCtxmenu,!1)}isVersionGreaterThanOrEqualTo(t,e){var[t,i,s]=t.split(".").map(t=>+t),[e,r,a]=e.split(".").map(t=>+t);return t!==e?e<t:i!==r?r<i:a<=s}setLightMode(t=!1){this.light_mode=t,this.light_mode?this.table.classList.add("light"):this.table.classList.remove("light"),this.renderTable()}back(){this.history.length&&(this.history.pop(),this.renderTable())}destroy(){removeEventListener("resize",this._onResize),removeEventListener("click",this._onClick),removeEventListener("contextmenu",this._onCtxmenu)}setContextMenuOptions(t){this.conextMenuOpts=t}on(t,e){this.user_callbacks[t].push(e)}off(t,e){this.user_callbacks[t]=this.user_callbacks[t].filter(t=>t!==e)}getMinRequiredWidth(t){var e=t.style.width,i=(t.style.width="1px",t.scrollWidth);return t.style.width=e,i}getAllMinWidths(){var t=[...this.table.querySelectorAll(".ft-td-name")].map(this.getMinRequiredWidth),t=Math.max(...t),e=[...this.table.querySelectorAll(".ft-td-size")].map(this.getMinRequiredWidth),e=Math.max(...e),i=[...this.table.querySelectorAll(".ft-td-kind")].map(this.getMinRequiredWidth),i=Math.max(...i),s=[...this.table.querySelectorAll(".ft-td-date")].map(this.getMinRequiredWidth);return[t,e,i,Math.max(...s)]}getActualWidth(t){t=getComputedStyle(t).getPropertyValue("width");return+t.substring(0,t.length-2)}getAllActualWidths(){return[this.getActualWidth(this.table.querySelector(".ft-td-name")),this.getActualWidth(this.table.querySelector(".ft-td-size")),this.getActualWidth(this.table.querySelector(".ft-td-kind")),this.getActualWidth(this.table.querySelector(".ft-td-date"))]}getHorizontalMarginPaddingBorder(e){return["margin-left","margin-right","border-left-width","border-right-width","padding-left","padding-right"].map(t=>{t=getComputedStyle(e).getPropertyValue(t);return+t.substring(0,t.length-2)}).reduce((t,e)=>t+e,0)}getAllColsMPB(){return this.getHorizontalMarginPaddingBorder(this.table.querySelector(".ft-td-name"))+this.getHorizontalMarginPaddingBorder(this.table.querySelector(".ft-td-size"))+this.getHorizontalMarginPaddingBorder(this.table.querySelector(".ft-td-kind"))+this.getHorizontalMarginPaddingBorder(this.table.querySelector(".ft-td-date"))}getAvailableTableWidth(){return this.getActualWidth(this.table.querySelector(".ft-tr"))-this.getAllColsMPB()}calculateColumnSizes(){var t=this.getAllMinWidths(),e=this.getAvailableTableWidth(),[i,s,r,a]=t,t=JSON.stringify([e,...t]);if(this.col_sizes_json===t)return this.resizing=!1;this.col_sizes_json=t;var[t,l,n,o]=this.getAllActualWidths(),d=i+s+r+a;let h,c,u,f;return d<=e?(this.table.style.minWidth=null,e=e-d,e=(e=(e-=(f=Math.floor(Math.min(a+.25*e,a+10)))-a)-((u=Math.floor(Math.min(r+.125*e,r+10)))-r))-((c=Math.floor(Math.min(s+.125*e,s+10)))-s),h=i+e):(this.table.style.minWidth=d+this.getAllColsMPB()+"px",h=i,c=s,u=r,f=a),this.col_widths.name=h,this.col_widths.size=c,this.col_widths.kind=u,this.col_widths.date=f,[h,c,u,f,t,l,n,o]}async resizeTable(){if(!this.resizing){this.resizing=!0;var t=this.calculateColumnSizes();if(!1===t)return this.resizing=!1;let[e,i,s,r,a,l,n,o]=t;var t=[...this.table.querySelectorAll(".ft-td-name")],d=[...this.table.querySelectorAll(".ft-td-kind")],h=[...this.table.querySelectorAll(".ft-td-size")],c=[...this.table.querySelectorAll(".ft-td-date")];await Promise.all([...t.map(t=>this.animate(t,"width",a,e,t=>t+"px",150)),...d.map(t=>this.animate(t,"width",n,s,t=>t+"px",150)),...h.map(t=>this.animate(t,"width",l,i,t=>t+"px",150)),...c.map(t=>this.animate(t,"width",o,r,t=>t+"px",150))]),this.resizing=!1}}getSortedEntries(t){return[...t].sort((t,e)=>{t=t[this.sort_col.toLowerCase()],e=e[this.sort_col.toLowerCase()];return t==e?0:e<t?"asc"===this.sort_dir?1:-1:t<e?"asc"===this.sort_dir?-1:1:void 0})}selectEntry(e){Object.keys(this.entries_map).forEach(t=>{this.entries_map[t].selected=e===this.entries_map[t]}),this.table.querySelectorAll(".ft-tr.active").forEach(t=>t.classList.remove("active"));var t=this.table.querySelector(`.ft-tr[data-eid='${e.id}']`);t&&t.classList.add("active")}getEntryById(t){for(i=0;i<this.entries.length;i++)if(this.entries[i].id==t)return this.entries[i];return!1}renderTable(){this.table.textContent="",this.fi&&this.fi.detachAllDragAreas();let s=document.createElement("div");s.classList.add("ft-th"),["Name","Size","Kind","Date"].forEach(t=>{var e=document.createElement("div");e.classList.add("ft-td-"+t.toLowerCase()),this.col_widths[t.toLowerCase()]&&(e.style.width=this.col_widths[t.toLowerCase()]+"px");let i=`<span class='ft-pull-left'>${t}</span>`;this.sort_col===t&&(t="asc"===this.sort_dir?'<i class="fa-solid fa-angle-up"></i>':'<i class="fa-solid fa-angle-down"></i>',i+=`<span class='ft-pull-right'>${t}</span>`),i+="<span class='ft-clear'></span>",e.innerHTML=i,s.appendChild(e)}),this.table.appendChild(s);var t=this.getSortedEntries(this.history.length?this.history.at(-1).children:this.entries);!function e(a,t,i=null,l=!0,n=0,o=!1){t.forEach(s=>{let r=document.createElement("div");var t;"folder"===s.getKind().toLowerCase()&&a.fi&&a.fi.attachToDragarea(r,"active"),r.dataset.eid=s.id,r.classList.add("ft-tr"),s.selected&&r.classList.add("active"),l&&!o||(r.style.display="none",o=!0),i&&(r.dataset.pid=i),["Name","Size","Kind","Date"].forEach(t=>{var e=document.createElement("div");e.classList.add("ft-td-"+t.toLowerCase()),a.col_widths[t.toLowerCase()]&&(e.style.width=a.col_widths[t.toLowerCase()]+"px");let i;i="Name"===t?s.getName(n):s["get"+t](),e.innerHTML=i,r.appendChild(e)}),a.table.appendChild(r),"folder"===s.kind.toLowerCase()&&Array.isArray(s.children)&&(t=a.getSortedEntries(s.children),e(a,t,s.id,s.expanded,n+1,o))})}(this,t),this.addTableStripes(),this.table.querySelectorAll(".ft-th > div").forEach(t=>{t.addEventListener("click",async t=>{t.preventDefault();let e;t.currentTarget.classList.contains("ft-td-size")&&(e="Size"),t.currentTarget.classList.contains("ft-td-kind")&&(e="Kind"),t.currentTarget.classList.contains("ft-td-date")&&(e="Date"),(e=t.currentTarget.classList.contains("ft-td-name")?"Name":e)&&(e===this.sort_col?this.sort_dir="asc"===this.sort_dir?"desc":"asc":this.sort_dir="asc",this.sort_col=e,this.renderTable());t=this.user_callbacks["table.sort"].map(t=>Promise.resolve(t(this.sort_col,this.sort_dir)));await Promise.all(t)})}),this.table.querySelectorAll(".ft-tr").forEach(a=>{a.addEventListener("click",async t=>{t.preventDefault();let e=t.target;for(;;){if(e.classList.contains("folder-carat"))return;if(!e.parentElement)break;e=e.parentElement}t=a.dataset.eid;let i=this.entries_map[t];this.selectEntry(i);t=this.user_callbacks["row.click"].map(t=>Promise.resolve(t(i)));await Promise.all(t)}),a.addEventListener("dblclick",async t=>{t.preventDefault();var t=a.dataset.eid;let e=this.entries_map[t];"Folder"===e.kind?(t=this.user_callbacks["folder.expand"].map(t=>Promise.resolve(t(e,!0))),await Promise.all(t),this.history.push(e),this.renderTable()):(this.selectEntry(e),t=this.user_callbacks["row.dblclick"].map(t=>Promise.resolve(t(e))),await Promise.all(t))}),a.addEventListener("contextmenu",async t=>{t.preventDefault(),this.removeCtxMenu();let e,i,s=document.documentElement;document.body;t.pageX?e=t.pageX:t.clientX&&(e=t.clientX+(s.scrollLeft||db.scrollLeft)),t.pageY?i=t.pageY:t.clientY&&(i=t.clientY+(s.scrollTop||db.scrollTop));t=a.dataset.eid;let r=this.entries_map[t];t=this.user_callbacks["row.ctxmenu"].map(t=>Promise.resolve(t(r)));return await Promise.all(t),this.conextMenuOpts.length&&(a.classList.add("outlined"),this.ctxmenu=document.createElement("div"),this.ctxmenu.classList.add("ft-contextmenu"),this.light_mode&&this.ctxmenu.classList.add("light"),this.ctxmenu.style.top=i-3+"px",this.ctxmenu.style.left=e+"px",this.ctxmenu.innerHTML=this.conextMenuOpts.map((t,e)=>"-"===t?"<hr>":`<div class='ft-context-item' data-idx='${e}'>${t.label}</div>`).join(""),document.body.append(this.ctxmenu),this.ctxmenu.querySelectorAll(".ft-context-item").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),this.removeCtxMenu(),this.conextMenuOpts[e.dataset.idx].action()})})),!1},!1)}),this.table.querySelectorAll(".folder-carat").forEach(l=>{l.addEventListener("click",async t=>{t.preventDefault();t=l.parentElement.parentElement.parentElement.dataset.eid;let i=this.entries_map[t];if("Folder"===i.kind){if(i.expanded){var a=this.user_callbacks["folder.collapse"].map(t=>Promise.resolve(t(i))),a=(await Promise.all(a),this.table.querySelector(`.ft-tr[data-eid="${t}"]`));l=a.querySelector(".folder-carat"),this.animate(l,"transform",90,0,t=>`rotate(${t}deg)`,150);let e=getComputedStyle(a).getPropertyValue("height");e=+e.substring(0,e.length-2);a=this.getAllChildrenIds(i).map(t=>this.table.querySelector(`.ft-tr[data-eid="${t}"]`));a.forEach(t=>{t.style.height=e+"px",t.style.overflowY="hidden",t.style.display=null}),await Promise.all(a.map(t=>this.animate(t,"height",e,0,t=>t+"px",150))),a.forEach(t=>{t.style.height=null,t.style.overflowY=null,t.style.display="none"}),i.expanded=!1}else{a=this.user_callbacks["folder.expand"].map(t=>Promise.resolve(t(i,!1))),a=(await Promise.all(a),this.table.querySelector(`.ft-tr[data-eid="${t}"]`));l=a.querySelector(".folder-carat"),this.animate(l,"transform",0,90,t=>`rotate(${t}deg)`,150);let s=this.table,e=getComputedStyle(a).getPropertyValue("height"),r=(e=+e.substring(0,e.length-2),[]);!function i(t){Array.isArray(t.children)&&t.children.forEach(t=>{var e=s.querySelector(`.ft-tr[data-eid="${t.id}"]`);r.push(e),"Folder"===t.kind&&t.expanded&&i(t)})}(i),r.forEach(t=>{t.style.height="0px",t.style.overflowY="hidden",t.style.display=null}),await Promise.all(r.map(t=>this.animate(t,"height",0,e,t=>t+"px",150))),r.forEach(t=>{t.style.height=null,t.style.overflowY=null}),i.expanded=!0}this.addTableStripes(),this.resizeTable()}})}),this.resizeTable()}removeCtxMenu(){this.table.querySelectorAll(".ft-tr.outlined").forEach(t=>t.classList.remove("outlined")),this.ctxmenu&&(this.ctxmenu.remove(),this.ctxmenu=null)}addTableStripes(){let e=0;this.table.querySelectorAll(".ft-tr").forEach(t=>{t.style.display&&"none"===t.style.display||(e%2==0?t.classList.contains("ft-tr-odd")||t.classList.add("ft-tr-odd"):t.classList.contains("ft-tr-odd")&&t.classList.remove("ft-tr-odd"),e++)})}getAllChildrenIds(t){let i=[];return function e(t){Array.isArray(t.children)&&t.children.forEach(t=>{i.push(t.id),"Folder"===t.kind&&e(t)})}(t),i}clearEntries(){this.entries=[],this.entries_map={},this.entry_counter=0}removeEntry(e){"Folder"===e.kind&&e.children&&e.children.forEach(t=>this.removeEntry(t)),e.parent&&(e.parent.children=e.parent.children.filter(t=>t!==e)),this.entries=this.entries.filter(t=>t!==e),delete this.entries_map[e.id]}addEntries(t,e=null){let i;(i=e?(e.children||(e.children=[]),e.children):this.entries).push(...t.map(t=>(t.prefix=this.prefix,t.id=this.entry_counter,t.parent=e,this.entries_map[t.id]=t,this.entry_counter++,t))),this.renderTable()}animate(n,o,d,h,c,u){return new Promise((r,t)=>{let a=Date.now(),l=Math.abs(d-h);!function s(){requestAnimationFrame(()=>{var t=(Date.now()-a)/u,t=l*t;let e;e=h<d?Math.max(d-t,h):Math.min(d+t,h);let i;i="function"==typeof c?c(e):""+e+c,n.style[o]=i,(e==h?r:s)()})}()})}}export{FSEntry,FSTable};