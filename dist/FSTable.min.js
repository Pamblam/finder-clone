// finder-clone - version 1.1.062 - https://github.com/Pamblam/finder-clone
class FSEntry{constructor(t,e,i,s){this.name=t,this.size=e,this.kind=i,this.date=s,this.children=null,this.parent=null,this.expanded=!1,this.selected=!1}getIcon(){switch(this.kind.toLowerCase()){case"spreadsheet":return'<i class="fa-solid fa-file-excel"></i>';case"document":return'<i class="fa-solid fa-file-word"></i>';case"pdf":return'<i class="fa-solid fa-file-pdf"></i>';case"archive":return'<i class="fa-solid fa-file-zipper"></i>';case"video":return'<i class="fa-solid fa-file-video"></i>';case"powerpoint":return'<i class="fa-solid fa-file-powerpoint"></i>';case"image":return'<i class="fa-solid fa-file-image"></i>';case"code":return'<i class="fa-solid fa-file-code"></i>';case"audio":return'<i class="fa-solid fa-file-audio"></i>';case"folder":return'<i class="fa-solid fa-folder"></i>';default:return'<i class="fa-solid fa-file"></i>'}}getName(t=0){var e=`<i class="fa-solid fa-angle-right folder-carat" ${`style="opacity: ${"folder"==this.kind.toLowerCase()?"1":"0"}; transform: rotate(${this.expanded?90:0}deg);"`}></i>`;return`<span class='ft-name-span'>${"&nbsp;&nbsp;&nbsp;&nbsp;".repeat(t)}${e} ${this.getIcon()} ${this.name}</span>`}getSize(){if(!this.size)return"";var t=["kB","MB","GB","TB","PB","EB","ZB","YB"];let e=this.size;if(Math.abs(e)<1e3)return e+" B";let i=-1;for(;e/=1e3,++i,1e3<=Math.round(10*Math.abs(e))/10&&i<t.length-1;);return e.toFixed(1)+" "+t[i]}getKind(){return this.kind}getDate(){return new Date(1e3*this.date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}getPath(t="/"){let e=this.parent;for(var i=[this.name];null!==e;)i.unshift(e.name),e=e.parent;let s=t+i.join(t);return"Folder"===this.kind&&(s+=t),s}}class FSTable{static version="1.1.062";constructor(t,e){this.entry_counter=0,this.table=document.createElement("div"),this.entries=[],this.entries_map={},this.table.classList.add("ft-table"),this.sort_col="Name",this.sort_dir="asc",this.ctxmenu=null,this.conextMenuOpts=[],this.user_callbacks={"folder.expand":[],"folder.collapse":[],"row.click":[],"table.sort":[],"row.dblclick":[],"row.ctxmenu":[]},this.onExpand=e,this.col_widths={},this.col_sizes_json="",t.replaceWith(this.table),this._onResize=t=>{var r=this.calculateColumnSizes();if(!1!==r){let[e,i,s,a]=r;this.table.querySelectorAll(".ft-td-name").forEach(t=>t.style.width=e+"px"),this.table.querySelectorAll(".ft-td-kind").forEach(t=>t.style.width=s+"px"),this.table.querySelectorAll(".ft-td-size").forEach(t=>t.style.width=i+"px"),this.table.querySelectorAll(".ft-td-date").forEach(t=>t.style.width=a+"px"),this.removeCtxMenu()}},addEventListener("resize",this._onResize),this._onClick=e=>{if(this.ctxmenu){let t=e.target;for(;;){if(t===this.ctxmenu)return;if(!t.parentElement)break;t=t.parentElement}this.removeCtxMenu()}},addEventListener("click",this._onClick),this._onCtxmenu=e=>{if(this.ctxmenu){let t=e.target;for(;;){if(t.classList.contains("ft-contextmenu"))return e.preventDefault(),e.stopPropagation(),!1;if(!t.parentElement)break;t=t.parentElement}for(t=e.target;;){if(t.classList.contains("ft-tr"))return;if(!t.parentElement)break;t=t.parentElement}this.removeCtxMenu()}},addEventListener("contextmenu",this._onCtxmenu,!1)}destroy(){removeEventListener("resize",this._onResize),removeEventListener("click",this._onClick),removeEventListener("contextmenu",this._onCtxmenu)}setContextMenuOptions(t){this.conextMenuOpts=t}on(t,e){this.user_callbacks[t].push(e)}off(t,e){this.user_callbacks[t]=this.user_callbacks[t].filter(t=>t!==e)}getMinRequiredWidth(t){var e=t.style.width,i=(t.style.width="1px",t.scrollWidth);return t.style.width=e,i}getAllMinWidths(){var t=[...this.table.querySelectorAll(".ft-td-name")].map(this.getMinRequiredWidth),t=Math.max(...t),e=[...this.table.querySelectorAll(".ft-td-size")].map(this.getMinRequiredWidth),e=Math.max(...e),i=[...this.table.querySelectorAll(".ft-td-kind")].map(this.getMinRequiredWidth),i=Math.max(...i),s=[...this.table.querySelectorAll(".ft-td-date")].map(this.getMinRequiredWidth);return[t,e,i,Math.max(...s)]}getActualWidth(t){t=getComputedStyle(t).getPropertyValue("width");return+t.substring(0,t.length-2)}getAllActualWidths(){return[this.getActualWidth(this.table.querySelector(".ft-td-name")),this.getActualWidth(this.table.querySelector(".ft-td-size")),this.getActualWidth(this.table.querySelector(".ft-td-kind")),this.getActualWidth(this.table.querySelector(".ft-td-date"))]}getHorizontalMarginPaddingBorder(e){return["margin-left","margin-right","border-left-width","border-right-width","padding-left","padding-right"].map(t=>{t=getComputedStyle(e).getPropertyValue(t);return+t.substring(0,t.length-2)}).reduce((t,e)=>t+e,0)}getAllColsMPB(){return this.getHorizontalMarginPaddingBorder(this.table.querySelector(".ft-td-name"))+this.getHorizontalMarginPaddingBorder(this.table.querySelector(".ft-td-size"))+this.getHorizontalMarginPaddingBorder(this.table.querySelector(".ft-td-kind"))+this.getHorizontalMarginPaddingBorder(this.table.querySelector(".ft-td-date"))}getAvailableTableWidth(){return this.getActualWidth(this.table.querySelector(".ft-tr"))-this.getAllColsMPB()}calculateColumnSizes(){var t=this.getAllMinWidths(),e=this.getAvailableTableWidth(),[i,s,a,r]=t,t=JSON.stringify([e,...t]);if(this.col_sizes_json===t)return this.resizing=!1;this.col_sizes_json=t;var[t,l,n,d]=this.getAllActualWidths(),o=i+s+a+r;let c,h,u,f;return o<=e?(this.table.style.minWidth=null,e=e-o,e=(e=(e-=(f=Math.floor(Math.min(r+.25*e,r+10)))-r)-((u=Math.floor(Math.min(a+.125*e,a+10)))-a))-((h=Math.floor(Math.min(s+.125*e,s+10)))-s),c=i+e):(this.table.style.minWidth=o+this.getAllColsMPB()+"px",c=i,h=s,u=a,f=r),this.col_widths.name=c,this.col_widths.size=h,this.col_widths.kind=u,this.col_widths.date=f,[c,h,u,f,t,l,n,d]}async resizeTable(){if(!this.resizing){this.resizing=!0;var t=this.calculateColumnSizes();if(!1===t)return this.resizing=!1;let[e,i,s,a,r,l,n,d]=t;var t=[...this.table.querySelectorAll(".ft-td-name")],o=[...this.table.querySelectorAll(".ft-td-kind")],c=[...this.table.querySelectorAll(".ft-td-size")],h=[...this.table.querySelectorAll(".ft-td-date")];await Promise.all([...t.map(t=>this.animate(t,"width",r,e,t=>t+"px",150)),...o.map(t=>this.animate(t,"width",n,s,t=>t+"px",150)),...c.map(t=>this.animate(t,"width",l,i,t=>t+"px",150)),...h.map(t=>this.animate(t,"width",d,a,t=>t+"px",150))]),this.resizing=!1}}getSortedEntries(t){return[...t].sort((t,e)=>{t=t[this.sort_col.toLowerCase()],e=e[this.sort_col.toLowerCase()];return t==e?0:e<t?"asc"===this.sort_dir?1:-1:t<e?"asc"===this.sort_dir?-1:1:void 0})}selectEntry(e){Object.keys(this.entries_map).forEach(t=>{this.entries_map[t].selected=e===this.entries_map[t]}),this.table.querySelectorAll(".ft-tr.active").forEach(t=>t.classList.remove("active"));var t=this.table.querySelector(`.ft-tr[data-eid='${e.id}']`);t&&t.classList.add("active")}renderTable(){this.table.textContent="";let s=document.createElement("div");s.classList.add("ft-th"),["Name","Size","Kind","Date"].forEach(t=>{var e=document.createElement("div");e.classList.add("ft-td-"+t.toLowerCase()),this.col_widths[t.toLowerCase()]&&(e.style.width=this.col_widths[t.toLowerCase()]+"px");let i=`<span class='ft-pull-left'>${t}</span>`;this.sort_col===t&&(t="asc"===this.sort_dir?'<i class="fa-solid fa-angle-up"></i>':'<i class="fa-solid fa-angle-down"></i>',i+=`<span class='ft-pull-right'>${t}</span>`),i+="<span class='ft-clear'></span>",e.innerHTML=i,s.appendChild(e)}),this.table.appendChild(s);var t=this.getSortedEntries(this.entries);!function e(r,t,i=null,l=!0,n=0,d=!1){t.forEach(s=>{let a=document.createElement("div");var t;a.dataset.eid=s.id,a.classList.add("ft-tr"),s.selected&&a.classList.add("active"),l&&!d||(a.style.display="none",d=!0),i&&(a.dataset.pid=i),["Name","Size","Kind","Date"].forEach(t=>{var e=document.createElement("div");e.classList.add("ft-td-"+t.toLowerCase()),r.col_widths[t.toLowerCase()]&&(e.style.width=r.col_widths[t.toLowerCase()]+"px");let i;i="Name"===t?s.getName(n):s["get"+t](),e.innerHTML=i,a.appendChild(e)}),r.table.appendChild(a),"folder"===s.kind.toLowerCase()&&Array.isArray(s.children)&&(t=r.getSortedEntries(s.children),e(r,t,s.id,s.expanded,n+1,d))})}(this,t),this.addTableStripes(),this.table.querySelectorAll(".ft-th > div").forEach(t=>{t.addEventListener("click",async t=>{t.preventDefault();let e;t.currentTarget.classList.contains("ft-td-size")&&(e="Size"),t.currentTarget.classList.contains("ft-td-kind")&&(e="Kind"),t.currentTarget.classList.contains("ft-td-date")&&(e="Date"),(e=t.currentTarget.classList.contains("ft-td-name")?"Name":e)&&(e===this.sort_col?this.sort_dir="asc"===this.sort_dir?"desc":"asc":this.sort_dir="asc",this.sort_col=e,this.renderTable());t=this.user_callbacks["table.sort"].map(t=>Promise.resolve(t(this.sort_col,this.sort_dir)));await Promise.all(t)})}),this.table.querySelectorAll(".ft-tr").forEach(r=>{r.addEventListener("click",async t=>{t.preventDefault();let e=t.target;for(;;){if(e.classList.contains("folder-carat"))return;if(!e.parentElement)break;e=e.parentElement}t=r.dataset.eid;let i=this.entries_map[t];this.selectEntry(i);t=this.user_callbacks["row.click"].map(t=>Promise.resolve(t(i)));await Promise.all(t)}),r.addEventListener("dblclick",async t=>{t.preventDefault();t=r.dataset.eid;let e=this.entries_map[t];this.selectEntry(e);t=this.user_callbacks["row.dblclick"].map(t=>Promise.resolve(t(e)));await Promise.all(t)}),r.addEventListener("contextmenu",async t=>{t.preventDefault(),this.removeCtxMenu();let e,i,s=document.documentElement;document.body;t.pageX?e=t.pageX:t.clientX&&(e=t.clientX+(s.scrollLeft||db.scrollLeft)),t.pageY?i=t.pageY:t.clientY&&(i=t.clientY+(s.scrollTop||db.scrollTop));t=r.dataset.eid;let a=this.entries_map[t];t=this.user_callbacks["row.ctxmenu"].map(t=>Promise.resolve(t(a)));return await Promise.all(t),this.conextMenuOpts.length&&(r.classList.add("outlined"),this.ctxmenu=document.createElement("div"),this.ctxmenu.classList.add("ft-contextmenu"),this.ctxmenu.style.top=i-3+"px",this.ctxmenu.style.left=e+"px",this.ctxmenu.innerHTML=this.conextMenuOpts.map((t,e)=>"-"===t?"<hr>":`<div class='ft-context-item' data-idx='${e}'>${t.label}</div>`).join(""),document.body.append(this.ctxmenu),this.ctxmenu.querySelectorAll(".ft-context-item").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),this.removeCtxMenu(),this.conextMenuOpts[e.dataset.idx].action()})})),!1},!1)}),this.table.querySelectorAll(".folder-carat").forEach(s=>{s.addEventListener("click",async t=>{t.preventDefault();var e,t=s.parentElement.parentElement.parentElement.dataset.eid;let i=this.entries_map[t];"Folder"===i.kind&&(i.expanded?(e=this.user_callbacks["folder.collapse"].map(t=>Promise.resolve(t(i))),await Promise.all(e),e=document.querySelector(`.ft-tr[data-eid="${t}"]`),s=e.querySelector(".folder-carat"),await this.animate(s,"transform",90,0,t=>`rotate(${t}deg)`,150),this.getAllChildrenIds(i).forEach(t=>{document.querySelector(`.ft-tr[data-eid="${t}"]`).style.display="none"}),i.expanded=!1):(e=this.user_callbacks["folder.expand"].map(t=>Promise.resolve(t(i))),await Promise.all(e),e=document.querySelector(`.ft-tr[data-eid="${t}"]`),s=e.querySelector(".folder-carat"),await this.animate(s,"transform",0,90,t=>`rotate(${t}deg)`,150),function e(t,i){Array.isArray(t.children)&&t.children.forEach(t=>{document.querySelector(`.ft-tr[data-eid="${t.id}"]`).style.display=i?null:"none","Folder"===t.kind&&(t.expanded||(i=!1),e(t,i))})}(i,!0),i.expanded=!0),this.addTableStripes(),this.resizeTable())})}),this.resizeTable()}removeCtxMenu(){this.table.querySelectorAll(".ft-tr.outlined").forEach(t=>t.classList.remove("outlined")),this.ctxmenu&&(this.ctxmenu.remove(),this.ctxmenu=null)}addTableStripes(){let e=0;this.table.querySelectorAll(".ft-tr").forEach(t=>{t.style.display&&"none"===t.style.display||(e%2==0?t.classList.contains("ft-tr-odd")||t.classList.add("ft-tr-odd"):t.classList.contains("ft-tr-odd")&&t.classList.remove("ft-tr-odd"),e++)})}getAllChildrenIds(t){let i=[];return function e(t){Array.isArray(t.children)&&t.children.forEach(t=>{i.push(t.id),"Folder"===t.kind&&e(t)})}(t),i}clearEntries(){this.entries=[],this.entries_map={},this.entry_counter=0}removeEntry(e){"Folder"===e.kind&&e.children&&e.children.forEach(t=>this.removeEntry(t)),e.parent&&(e.parent.children=e.parent.children.filter(t=>t!==e)),this.entries=this.entries.filter(t=>t!==e),delete this.entries_map[e.id]}addEntries(t,e=null){let i;(i=e?(e.children||(e.children=[]),e.children):this.entries).push(...t.map(t=>(t.id=this.entry_counter,t.parent=e,this.entries_map[t.id]=t,this.entry_counter++,t))),this.renderTable()}animate(n,d,o,c,h,u){return new Promise((a,t)=>{let r=Date.now(),l=Math.abs(o-c);!function s(){requestAnimationFrame(()=>{var t=(Date.now()-r)/u,t=l*t;let e;e=c<o?Math.max(o-t,c):Math.min(o+t,c);let i;i="function"==typeof h?h(e):""+e+h,n.style[d]=i,(e==c?a:s)()})}()})}}export{FSEntry,FSTable};